!function(n){function e(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return n[t].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var r={};e.m=n,e.c=r,e.i=function(n){return n},e.d=function(n,r,t){e.o(n,r)||Object.defineProperty(n,r,{configurable:!1,enumerable:!0,get:t})},e.n=function(n){var r=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(r,"a",r),r},e.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},e.p="",e(e.s=9)}([function(n,e){n.exports=require("fs")},function(n,e){n.exports=require("path")},function(n,e){n.exports=require("bluebird")},function(n,e){n.exports=require("lodash")},function(n,e){n.exports=require("readline")},function(n,e,r){"use strict";function t(n){return p(n).then(function(n){var e=a.map(n,function(n){return new u(function(e){var r=f.createInterface({input:l.createReadStream(n)}),t=[];r.on("line",function(n){a.startsWith(n,"exports.")&&t.push(a.map(n.substring(8,n.length).split("="),a.trim)[0])}),r.on("close",function(r){e({key:s.relative(s.join(process.cwd(),"app","model","mysql"),n),values:t})})})});return u.all(e).then(function(n){var e="module.exports = {\n";return a.forEach(n,function(n){var r=n.values,t=n.key;a.forEach(r,function(n){e+="\t"+n+" : require('"+t+"')."+n+",\n"})}),e+="}\n"})})}function o(){var n=s.join(process.cwd(),"app","model","mysql");t(n).then(function(e){l.writeFileAsync(s.join(n,"index.js"),e).then(function(n){n?console.error(n):console.log("handle mysql model succeed")},function(n){console.error("handle mysql model error")})})}function i(n){return p(n).then(function(n){var e=a.map(n,function(n){return new u(function(e){var r=f.createInterface({input:l.createReadStream(n)}),t=[];r.on("line",function(n){a.startsWith(n,"exports.")&&t.push(a.map(n.substring(8,n.length).split("="),a.trim)[0])}),r.on("close",function(r){e({key:s.relative(s.join(process.cwd(),"app","model"),n),values:t})})})});return u.all(e).then(function(n){var e="";return a.forEach(n,function(n){var r=n.values,t=n.key;a.forEach(r,function(n){e+="exports."+n+" = require('./"+t+"')."+n+"\n"})}),e})})}function c(){i(s.join(process.cwd(),"app","model","mongo")).then(function(n){l.writeFileAsync(s.join(process.cwd(),"app","model","index.js"),n).then(function(n){n?console.error(n):console.log("handle mongo model succeed")},function(n){console.error("handle mongo model error")})})}var s=r(1),u=r(2),l=u.promisifyAll(r(0)),a=r(3),f=r(4),p=r(6).loopFind;e.MockMongo=c,e.MockMysql=o},function(n,e,r){"use strict";var t=r(1),o=r(2),i=o.promisifyAll(r(0)),c=r(3);e.loopFind=function(n){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return i.statAsync(n).then(function(s){return s?s.isFile()?r&&c.endsWith(n,"index.js")?[]:[n]:s.isDirectory()?i.readdirAsync(n).then(function(r){if(r){var i=c.map(r,function(r){return e.loopFind(t.join(n,r))});return o.all(i).then(function(n){return c.flattenDeep(n)})}return[]},function(n){return[]}):void 0:[]},function(n){return[]})}},function(n,e,r){"use strict";function t(n){return l(n).then(function(n){var e=u.map(n,function(n){return new c(function(e){e(i.basename(n,".js"))})});return c.all(e).then(function(n){var e=u.flatMapDeep(n),r="",t="";return u.forEach(e,function(n){r+="let "+n+" = require('./"+n+"')\n",t+="\t'"+n+"' : "+n+",\n"}),t="let models = {\n"+t+"}",r+t},function(n){})})}function o(){t(i.join(process.cwd(),"app","service")).then(function(n){n+="\n\nexports.boot = function(app) {\n    app.use(function(req,res, next) {\n        req.models = models;\n        return next();\n    })\n}\n",s.writeFileAsync(i.join(process.cwd(),"app","service","index.js"),n).then(function(n){n?console.log(n):console.log("handle service succeed")},function(n){console.error("handle service error")})})}var i=r(1),c=r(2),s=c.promisifyAll(r(0)),u=r(3),l=(r(4),r(6).loopFind);e.MockService=o},,function(n,e,r){"use strict";function t(n){return l.statAsync(n).then(function(e){return e?e.isFile()?a.endsWith(n,"index.js")?[]:[n]:e.isDirectory()?l.readdirAsync(n).then(function(e){if(e){var r=a.map(e,function(e){return t(s.join(n,e))});return u.all(r).then(function(n){return a.flattenDeep(n)})}return[]},function(n){return[]}):void 0:[]},function(n){return[]})}function o(n,e){var r=e.name;delete e.name,delete e.functionName,delete e.controllerName,n[r]=e}function i(n){return t(n).then(function(n){var e=a.map(n,function(n){return new u(function(e){var r=!1,t=!1,o={params:[]},i=[],c=f.createInterface({input:l.createReadStream(n)});c.on("line",function(e){if(a.includes(e,"/**"))return r=!0,t=!1,void(o={params:[],controllerName:s.parse(n).name});if(a.includes(e,"**/"))return r=!1,t=!0,void i.push(o);if(r){if(a.includes(e,"@name"))o.name=a.map(e.split("@name"),a.trim)[1];else if(a.includes(e,"@link"))o._links=a.map(e.split("@link"),a.trim)[1];else if(a.includes(e,"@method"))o.method=a.map(e.split("@method"),a.trim)[1];else if(a.includes(e,"@desc"))o.des=a.map(e.split("@desc"),a.trim)[1];else if(a.includes(e,"@param")){var c=a.map(e.split("@param"),a.trim)[1];c=c.replace(/\'/g,'"');try{var u=JSON.parse(c);o.params?o.params.push(u):o.params=[u]}catch(n){}}else if(a.includes(e,"@header")){var l=a.map(e.split("@header"),a.trim)[1];l=l.replace(/\'/g,'"');try{var f=JSON.parse(l);o.headers?o.headers.push(f):o.headers=[f]}catch(n){}}}else t&&a.startsWith(e,"exports")&&a.includes(e,"=")&&(t=!1,o.functionName=a.map(e.split(/=|\./),a.trim)[1])}),c.on("close",function(r){e({apiList:i,controller:n})})})});return u.all(e).then(function(n){var e="",r=a.map(n,function(n){var r=n.apiList;if(r&&r.length>0){var t=s.parse(n.controller).name;return e+="let "+t+"C = require('./"+t+".js')\n",r}return[]}),t=a.flattenDeep(r),i={},c="";return a(t).forEach(function(n){"get"===n.method.toLocaleLowerCase()?c+="  app.get('"+n._links+"',"+n.controllerName+"C."+n.functionName+")\n":c+="  app.post('"+n._links+"',"+n.controllerName+"C."+n.functionName+")\n",o(i,n)}),{code:0,api:JSON.stringify(i,null,2),reqPath:c,controllerNames:e}},function(n){})})}function c(n,e,r){return l.statAsync(n).then(function(t){if(t.isFile()){var o=f.createInterface({input:l.createReadStream(n)}),i="",c=!1,u=!1;o.on("line",function(n){return a.includes(n,"@require")?(u=!0,i+=r,void(i+=n+"\n")):u?a.includes(n,"@start")?(c=!0,i+=n+"\n",void(i+=e)):a.includes(n,"@end")?(c=!1,void(i+=n+"\n")):void(c||(i+=n+"\n")):void 0}),o.on("close",function(e){l.writeFileAsync(s.join(s.dirname(n),"index.js"),i).then(function(n){n?console.log(n):console.log("handle controller index succeed")},function(n){console.error("handle controller error")})})}else console.log("not find file at: "+n)},function(n){console.log("error happend when handle controller index file")})}var s=r(1),u=r(2),l=u.promisifyAll(r(0)),a=r(3),f=r(4);!function(){i(s.join(process.cwd(),"app","controller")).then(function(n){0===n.code&&(c(s.join(process.cwd(),"app","controller","index.js"),n.reqPath,n.controllerNames),l.writeFileAsync(s.join(process.cwd(),"mock","mock.api.json"),n.api).then(function(n){n?console.log(n):console.log("mock api succeed")},function(n){console.error("mock api error")}))})}(),r(7).MockService(),r(5).MockMongo(),r(5).MockMysql()}]);